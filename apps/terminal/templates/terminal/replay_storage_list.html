{% extends 'base.html' %}
{% load i18n static %}

{% block content %}
<div class="wrapper wrapper-content animated fadeIn">
    <div class="col-lg-12">
        <div class="tabs-container">
            <ul class="nav nav-tabs">
                <li class="active"><a href="{% url 'terminal:replay-storage-list' %}"> {% trans 'Replay storage' %}</a></li>
                <li><a href="{% url 'terminal:command-storage-list' %}" >{% trans 'Command storage' %}</a></li>
            </ul>
            <div class="tab-content">
                <div id="my-tickets" class="tab-pane active">
                    <div class="panel-body">
                        <div class="uc pull-left m-r-5"><a href="{% url "terminal:replay-storage-create" %}" class="btn btn-sm btn-primary"> {% trans "Create replay storage" %} </a></div>
                        <table class="table table-striped table-bordered table-hover" id="replay_storage_list_table" >
                            <thead>
                                <tr>
                                    <th class="text-center">
                                        <input id="" type="checkbox" class="ipt_check_all">
                                    </th>
                                    <th class="text-center">{% trans 'Name' %}</th>
                                    <th class="text-center">{% trans 'Type' %}</th>
                                    <th class="text-center">{% trans 'Action' %}</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block content_bottom_left %}{% endblock %}
{% block custom_foot_js %}
<script>
var replay_storage_table;
function initTable() {
     var options = {
        ele: $('#replay_storage_list_table'),
        columnDefs: [
            {targets: 3, createdCell: function (td, cellData, rowData) {
                    var name = htmlEscape(rowData.name);
                    var update_btn = '<a href="{% url "terminal:replay-storage-update" pk=DEFAULT_PK %}" class="btn btn-xs btn-info">{% trans "Update" %}</a>'.replace('00000000-0000-0000-0000-000000000000', cellData);
                    var del_btn = '<a class="btn btn-xs btn-danger m-l-xs btn-del" data-uid="{{ DEFAULT_PK }}" mark=1 data-name="99991938">{% trans "Delete" %}</a>'
                        .replace('{{ DEFAULT_PK }}', cellData)
                        .replace('99991938', name);
                    var test_btn = '<a class="btn btn-xs btn-primary m-l-xs btn-test-connective" data-uid="{{ DEFAULT_PK }}">{% trans 'Test' %}</a>'.replace('{{ DEFAULT_PK }}', cellData);
                    $(td).html(update_btn + test_btn + del_btn)
                }
            }
        ],
        ajax_url: '{% url "api-terminal:replay-storage-list" %}',
        columns: [
            {data: "id"}, {data: "name" }, {data: "type"}, {data: "id"}
        ],
        op_html: $('#actions').html()
    };
    replay_storage_table = jumpserver.initServerSideDataTable(options);
    return replay_storage_table
}

$(document).ready(function(){
    initTable()
})
.on('click', '.btn-del', function () {
    var $this = $(this);
    var uid = $this.data('uid');
    var name = $this.data('name');
    var the_url = '{% url "api-terminal:replay-storage-detail" pk=DEFAULT_PK %}'
        .replace('{{ DEFAULT_PK }}', uid);
    objectDelete($this, name, the_url);
})
.on('click', '.btn-test-connective', function () {
    var $this = $(this);
    var uid = $this.data('uid');
    var the_url = '{% url "api-terminal:replay-storage-test-connective" pk=DEFAULT_PK %}'.replace('{{ DEFAULT_PK }}', uid);
    var error = function (data) {
        toastr.error(data)
    };
    var success = function(data) {
        var isValid = data.is_valid;
        if (isValid){
            toastr.success(data.msg)
        }
        else{
            toastr.error(data.msg)
        }
    };
    requestApi({
        url: the_url,
        error: error,
        method: 'GET',
        success: success,
        flash_message: false
    });
})
</script>
{% endblock %}

